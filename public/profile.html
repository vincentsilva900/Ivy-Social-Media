<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Ivy âœ§ Your Profile</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link href="/css/custom.css" rel="stylesheet">
  <style>
    body {
      background: linear-gradient(135deg, #0a0a0a, #1a1a1a);
      font-family: 'Orbitron', sans-serif;
      color: #fff;
      overflow-x: hidden;
    }
  </style>
</head>

<body class="flex items-center justify-center min-h-screen">

  <div class="bg-black bg-opacity-70 p-8 rounded-lg shadow-lg max-w-2xl w-full border border-purple-600">
    <h1 id="profileUsername" class="text-4xl font-bold text-center mb-4 glow-text">Loading Profile âœ§</h1>

    <!-- Profile Picture -->
    <img id="profilePicture" class="w-32 h-32 rounded-full mx-auto mb-6 border-4 border-purple-400 object-cover" src="/images/default-profile.jpg" alt="Profile Picture">
    <input type="file" id="uploadProfilePic" accept="image/*" class="block mx-auto mb-6">

    <!-- Bio & Location -->
    <p id="profileBio" class="text-center text-purple-400 mb-2 italic">âœ¨ Bio loading...</p>
    <p id="profileLocation" class="text-center text-pink-400 mb-6 italic">ðŸŒŽ Location loading...</p>

    <!-- Music Player -->
    <audio id="profileMusic" class="w-full mb-6" controls>
      <source id="musicSource" src="" type="audio/mpeg">
      Your browser does not support the audio element.
    </audio>
    <input type="file" id="uploadMusic" accept="audio/*" class="block mx-auto mb-8">

    <!-- Status Post -->
    <form id="postForm" class="flex flex-col space-y-4">
      <textarea id="postContent" placeholder="Post your status âœ§" class="p-2 border rounded bg-gray-800 text-white resize-none"></textarea>
      <button type="submit" class="p-2 bg-gradient-to-r from-green-400 to-purple-500 text-white rounded hover:from-purple-400 hover:to-pink-500">Post Status âœ§</button>
    </form>

    <!-- Your Posts -->
    <h2 class="text-2xl text-center font-bold mt-8 mb-4 text-pink-400">Your Posts âœ§</h2>
    <div id="userPosts" class="space-y-4"></div>

    <a href="/feed.html" class="block text-center mt-8 text-purple-500 underline hover:text-pink-400">â‡¢ Go to Public Status Board âœ§</a>
  </div>

  <!-- âœ§ JavaScript âœ§ -->
  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const userId = urlParams.get('id');

    async function loadProfile() {
      if (!userId) {
        alert('No user ID found!');
        return;
      }

      const response = await fetch(`https://ivy-social-media.onrender.com/profile/${userId}`);
      const data = await response.json();

      if (data.user) {
        document.getElementById('profileUsername').innerText = data.user.username + ' âœ§';
        document.getElementById('profileBio').innerText = data.user.bio ? `âœ¨ ${data.user.bio}` : 'âœ¨ No bio yet.';
        document.getElementById('profileLocation').innerText = data.user.location ? `ðŸŒŽ ${data.user.location}` : 'ðŸŒŽ Unknown location.';

        const profilePicElement = document.getElementById('profilePicture');
        profilePicElement.src = data.user.profilePic || '/images/default-profile.jpg';

        const musicSource = document.getElementById('musicSource');
        if (data.user.music) {
          musicSource.src = data.user.music;
          document.getElementById('profileMusic').load();
        }

        const postsContainer = document.getElementById('userPosts');
        postsContainer.innerHTML = '';
        data.posts.forEach(post => {
          const postElement = document.createElement('div');
          postElement.className = 'p-4 border border-purple-300 rounded-lg mb-2 bg-gray-900 text-white';
          postElement.innerText = post.content;
          postsContainer.appendChild(postElement);
        });
      } else {
        alert('User not found!');
      }
    }

    // Upload Profile Picture
    document.getElementById('uploadProfilePic').addEventListener('change', async (e) => {
      const file = e.target.files[0];
      const formData = new FormData();
      formData.append('profilePic', file);
      formData.append('userId', userId);

      await fetch('https://ivy-social-media.onrender.com/upload-profile-pic', {
        method: 'POST',
        body: formData
      });
      alert('Profile picture updated!');
      location.reload();
    });

    // Upload Music
    document.getElementById('uploadMusic').addEventListener('change', async (e) => {
      const file = e.target.files[0];
      const formData = new FormData();
      formData.append('musicFile', file);
      formData.append('userId', userId);

      await fetch('https://ivy-social-media.onrender.com/upload-music', {
        method: 'POST',
        body: formData
      });
      alert('Music updated!');
      location.reload();
    });

    // Post Status
    document.getElementById('postForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const content = document.getElementById('postContent').value;

      await fetch('https://ivy-social-media.onrender.com/create-post', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ userId, content })
      });

      alert('Status posted!');
      location.reload();
    });

    loadProfile();
  </script>

</body>
</html>